package cn.hackedmc.apotheosis.module.impl.exploit;

import cn.hackedmc.apotheosis.api.Rise;
import cn.hackedmc.apotheosis.module.Module;
import cn.hackedmc.apotheosis.module.api.Category;
import cn.hackedmc.apotheosis.module.api.ModuleInfo;
import cn.hackedmc.apotheosis.newevent.Listener;
import cn.hackedmc.apotheosis.newevent.annotations.EventLink;
import cn.hackedmc.apotheosis.newevent.impl.packet.PacketReceiveEvent;
import cn.hackedmc.apotheosis.util.chat.ChatUtil;
import cn.hackedmc.apotheosis.util.interfaces.InstanceAccess;
import net.minecraft.network.Packet;
import net.minecraft.network.play.server.S2CPacketSpawnGlobalEntity;

/**
 * @author Auth
 * @since 3/02/2022
 */
@Rise
@ModuleInfo(name = "module.combat.lightningtracker.name", description = "module.exploit.lightningtracker.description", category = Category.EXPLOIT)
public class LightningTracker extends Module {

    @EventLink()
    public final Listener<PacketReceiveEvent> onPacketReceiveEvent = event -> {

        final Packet<?> p = event.getPacket();

        if (p instanceof S2CPacketSpawnGlobalEntity) {
            final S2CPacketSpawnGlobalEntity wrapper = (S2CPacketSpawnGlobalEntity) p;
            final int x = (int) (Math.round((wrapper.func_149051_d() / 32.0D) * 100) / 100.0F);
            final int y = (int) (Math.round((wrapper.func_149050_e() / 32.0D) * 100) / 100.0F);
            final int z = (int) (Math.round((wrapper.func_149049_f() / 32.0D) * 100) / 100.0F);

            if (wrapper.func_149053_g() == 1) {
                ChatUtil.display("Lightning struck at " + x + ", " + y + ", " + z + " (" + (int) InstanceAccess.mc.thePlayer.getDistance(x, y, z) + " blocks away)");
            }
        }
    };
}