package cn.hackedmc.alexander.module.impl.exploit.disabler;

import cn.hackedmc.alexander.component.impl.player.BlinkComponent;
import cn.hackedmc.alexander.newevent.Listener;
import cn.hackedmc.alexander.newevent.annotations.EventLink;
import cn.hackedmc.alexander.newevent.impl.motion.PreUpdateEvent;
import cn.hackedmc.alexander.newevent.impl.packet.PacketSendEvent;
import cn.hackedmc.alexander.util.packet.PacketUtil;
import cn.hackedmc.alexander.module.impl.exploit.Disabler;
import cn.hackedmc.alexander.value.Mode;
import net.minecraft.entity.player.PlayerCapabilities;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C13PacketPlayerAbilities;

public class HYTChickenDisabler extends Mode<Disabler> {
    public HYTChickenDisabler(String name, Disabler parent) {
        super(name, parent);
    }

    @Override
    public void onDisable() {
        BlinkComponent.blinking = false;
    }

    @EventLink
    private final Listener<PreUpdateEvent> onPreUpdate = event -> {
        final PlayerCapabilities capabilities = new PlayerCapabilities();
        capabilities.isFlying = true;
        PacketUtil.send(new C13PacketPlayerAbilities(capabilities));

        BlinkComponent.blinking = true;
        if (mc.thePlayer.ticksExisted % 4 == 0)
            BlinkComponent.dispatch();
    };

    @EventLink
    private final Listener<PacketSendEvent> onPacketSend = event -> {
        if (event.getPacket() instanceof C03PacketPlayer) ((C03PacketPlayer) event.getPacket()).onGround = false;
    };
}
